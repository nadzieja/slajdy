<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="lyrics,christian,music,slides,tchnienie,Boga" />
    <meta name="description" content="Slajdy - Tchnienie Boga" />
    <title>Slajdy - Tchnienie Boga</title>
    <script src="js/remark-0.9.1.min.js" type="text/javascript"> </script>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
    <script>
      var slideshow = remark.create({
        ratio: '3:2',
        sourceUrl: 'md/all-slides.md'
      });

      var allNames = slideshow.getSlides()
        .map(function(slide) {
          return slide.properties.name;
        })
        .filter(function(name) {
          return name;
        });

      function addKeydown(code, callback) {
        document.body.addEventListener('keydown', function(event) {
          var keyCode = event.which || event.keyCode;
          if (keyCode === code) {
            event.preventDefault();
            callback();
          }
        });
      }

      var names = [];
      function addNamedSlidesHandler(slideNames) {
        function cycleArray(values) {
          var idx = 0;
          return function() {
            var value = values[idx];
            idx = idx + 1 < values.length ? idx + 1 : 0;
            return value;
          };
        }
        var nextSlideName = cycleArray(slideNames);

        addKeydown(116, function() { // F5
          slideshow.gotoSlide(nextSlideName());
        });
        addKeydown(27, function() { // Escape
          slideshow.gotoSlide(nextSlideName());
        });
      }
      addNamedSlidesHandler(names);

      addKeydown(190, function() { // dot
        slideshow.toggleBlackout();
      });

      function getQueryString() {
        var result = {}, queryString = location.search.slice(1),
        re = /([^&=]+)=([^&]*)/g, m;

        while (m = re.exec(queryString)) {
          result[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }

        return result;
      }

      function getSlideNames(url, callback) {
        if (!url) {
          callback();
          return;
        }
        var xhr = new XMLHttpRequest();
        xhr.responseType = 'text';
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              var slideNames = xhr.response.split(/\s+/);
              callback(slideNames);
            } else {
              callback();
            }
          }
        }
        xhr.open('GET', url, true);
        xhr.send(null);
      }

      var data = getQueryString()['data'];
      var url = data && 'md/' + data + '.txt';
      document.title = data && 'Slajdy ' + data + ' - Tchnienie Boga' || 'Slajdy - Tchnienie Boga';

      getSlideNames(url, function(slideNames) {
        if (!slideNames) {
          allNames.forEach(function(name) {
            names.push(name);
          }); 
        } else {
          slideNames.forEach(function(name) {
            if (allNames.indexOf(name) >= 0) {
              names.push(name);
            }
          });
        }
      });

    </script>
  </body>
</html>
