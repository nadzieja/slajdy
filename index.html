<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="lyrics,christian,music,slides,tchnienie,Boga" />
    <meta name="description" content="Slajdy - Tchnienie Boga" />
    <title>Slajdy - Tchnienie Boga</title>
    <script src="js/jquery-3.2.0.min.js" type="text/javascript"> </script>
    <script src="js/remark-0.9.1.min.js" type="text/javascript"> </script>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
    <script>
      function setupSlideshow(source) {
        function addKeydown(code, callback) {
          document.body.addEventListener('keydown', function(event) {
            var keyCode = event.which || event.keyCode;
            if (keyCode === code) {
              event.preventDefault();
              callback();
            }
          });
        }

        var slideshow = remark.create({
          ratio: '3:2',
          source: source
        });
        var queryParams = getQueryString();
        var slideNames = queryParams.slajdy && queryParams.slajdy.split(',');
        var allNames = slideNames || slideshow.getSlides()
        .map(slide => slide.properties.name)
        .filter(name => name);

        function addNamedSlidesHandler(slideNames) {
          function cycleArray(values) {
            var idx = 0;
            return function() {
              var value = values[idx];
              idx = idx + 1 < values.length ? idx + 1 : 0;
              return value;
            };
          }
          var nextSlideName = cycleArray(slideNames);

          addKeydown(116, function() { // F5
            slideshow.gotoSlide(nextSlideName());
          });
          addKeydown(27, function() { // Escape
            slideshow.gotoSlide(nextSlideName());
          });
        }
        addNamedSlidesHandler(allNames);

        addKeydown(190, function() { // dot
          slideshow.toggleBlackout();
        });

      }

      $.get('md/all-slides.md', setupSlideshow, 'text');

      // var source = 'name:' + names.map(function(name) {
      //   return result.responseText.split(/---\nname:/).find(function (slide) {
      //     return slide.split(/\n/)[0] === name
      //   });
      // }).join('---\nname:');


      function getQueryString() {
        var result = {}, queryString = location.search.slice(1),
        re = /([^&=]+)=([^&]*)/g, m;

        while (m = re.exec(queryString)) {
          result[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }

        return result;
      }

      function getSlideNames(url, callback) {
        if (!url) {
          callback();
          return;
        }
        var xhr = new XMLHttpRequest();
        xhr.responseType = 'text';
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              var slideNames = xhr.response.split(/\s+/);
              callback(slideNames);
            } else {
              callback();
            }
          }
        }
        xhr.open('GET', url, true);
        xhr.send(null);
      }

      var data = getQueryString()['data'];
      var url = data && 'md/' + data + '.txt';
      document.title = data && 'Slajdy ' + data + ' - Tchnienie Boga' || 'Slajdy - Tchnienie Boga';

    </script>
  </body>
</html>
